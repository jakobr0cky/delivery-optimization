<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Route</title>

    <style>
        #dropdownMenu {
            display: block;
            position: absolute;
            margin-top: 5px;
        }

        #routeLink {
            margin-top: 35px;
        }
    </style>

</head>

<body>
    <h1>Generate Route</h1>
    <label for="locationInput">Enter location:</label>
    <input type="text" id="locationInput" oninput="updateDropdown()" />
    <select id="dropdownMenu"></select>
    <button onclick="generateRoute()">Generate Route</button>
    <p id="routeLink"></p>

    <script>
        async function updateDropdown() {
            const inputElement = document.getElementById('locationInput');
            const dropdownElement = document.getElementById('dropdownMenu');
            const inputValue = inputElement.value;

            // Clear previous options
            dropdownElement.innerHTML = '';

            const response = await fetch(`https://data.wien.gv.at/daten/OGDAddressService.svc/GetAddressInfo?Address=${inputValue}`);
            const responseData = await response.json();

            // Add new options based on the input value
            for (let i = 0; i < responseData.features.length; i++) {
                const option = document.createElement('option');
                option.value = responseData.features[i].properties.Adresse;
                option.text = responseData.features[i].properties.Adresse;
                dropdownElement.appendChild(option);
            }


            // Show the dropdown when there is more than one option
            if (inputValue.length > 1) {
                dropdownElement.style.display = 'block';
            } else {
                dropdownElement.style.display = 'none';
            }
        }

        async function generateRoute() {
            const dropdownElement = document.getElementById('dropdownMenu');
            const routeLinkElement = document.getElementById('routeLink');

            if (dropdownElement.children[0] == undefined || dropdownElement.children[0].value == undefined || dropdownElement.children[0] == null) {
                routeLinkElement.innerHTML = `Adress not found`;
                return;
            }

            if ("geolocation" in navigator) {
                console.log('ja');
            } else {
                console.log('nein');
            }

            try {
                const response = await fetch('http://localhost:3000/example', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ 'adress': dropdownElement.value })
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('Response from server:', result);

                    navigator.geolocation.getCurrentPosition((position) => {
                        const currentLocation = position.coords.latitude+','+position.coords.longitude;
                        // Construct Google Maps link
                        const googleMapsLink = `https://www.google.com/maps/dir/${currentLocation}/${result.coordinates}`;

                        // Display the link on the webpage
                        routeLinkElement.innerHTML = `Generated Route: <a href="${googleMapsLink}" target="_blank">${googleMapsLink}</a>`;
                    });
                } else {
                    console.error('Failed to send POST request:', response.statusText);
                }
            } catch (error) {
                console.error('Error:', error);
            }

        }


    </script>
</body>

</html>